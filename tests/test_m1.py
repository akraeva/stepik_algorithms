import pytest
from src.module_1 import m_1_2_1, m_1_2_2, m_1_2_3, m_1_2_4, m_1_2_5


# === Задача 1 ===


@pytest.mark.parametrize(
    "data, expected",
    [
        ("([](){([])})", "Success"),
        ("()[]}", 5),
        ("{{[()]]", 7),
        ("{{{[][][]", 3),
        ("{*{{}", 3),
        ("[[*", 2),
        ("{*}", "Success"),
        ("{{", 2),
        ("{}", "Success"),
        ("", 0),
        ("}", 1),
        ("*{}", "Success"),
        ("{{{**[][][]", 3),
        ("((({[]})", 2),
        ("{}([]", 3),
        ("(slkj, (lk[lve]) ,l)", "Success"),
        ("dasdsadsadas]]]", 13),
        ("[]([]", 3),
        ("{{{[][][]", 3),
        ("{{[()]}", 1),
        ("(slkj{lk[lsj]}", 1),
        ("{}[}([]:", 4),
    ],
    ids=[
        "correct_nested",
        "extra_closing",
        "wrong_order",
        "missing_closing",
        "with_symbols",
        "single_open",
        "symbols_inside",
        "only_open",
        "simple_pair",
        "empty_string",
        "only_closing",
        "symbols_before",
        "complex_symbols",
        "wrong_open",
        "missing_close",
        "text_inside",
        "many_closing",
        "mixed_missing",
        "duplicate_case",
        "unclosed_open",
        "nested_missing",
        "wrong_middle",
    ],
)
def test_m_1_2_1(data, expected):
    assert m_1_2_1(data) == expected


# === Задача 2 ===


@pytest.mark.parametrize(
    "parents, count, expected",
    [
        # базовые примеры
        ([9, 7, 5, 5, 2, 9, 9, 9, 2, -1], 10, 4),
        ([4, -1, 4, 1, 1], 5, 3),
        ([-1, 0, 4, 0, 3], 5, 4),
        ([-1], 1, 1),
        # граничные случаи
        ([], 0, 0),
        ([-1, 0, 1, 2, 3], 5, 5),  # цепочка
        ([-1, 0, 0, 0, 0], 5, 2),  # звезда
        ([-1, 0, 0, 1, 1, 3, 3], 7, 4),  # ветвление
        ([1, 2, 3, -1], 4, 4),  # корень не 0
        ([-1, 0, 1, 2, 3, 4, 5, 6], 8, 8),  # длинная цепочка
    ],
)
def test_tree_height(parents, count, expected):
    assert m_1_2_2(parents, count) == expected


# === Задача 3 ===


@pytest.mark.parametrize(
    "buf_size, count, packages, expected",
    [
        # --- базовые случаи ---
        (1, 0, [], []),
        (1, 1, [[0, 0]], [0]),
        (1, 1, [[0, 1]], [0]),
        # --- переполнение буфера ---
        (1, 2, [[0, 1], [0, 1]], [0, -1]),
        (1, 2, [[0, 1], [1, 1]], [0, 1]),
        # --- несколько пакетов ---
        (
            2,
            8,
            [[0, 0], [0, 0], [0, 0], [1, 0], [1, 0], [1, 1], [1, 2], [1, 3]],
            [0, 0, 0, 1, 1, 1, 2, -1],
        ),
        (
            2,
            8,
            [[0, 0], [0, 0], [0, 0], [1, 1], [1, 0], [1, 0], [1, 2], [1, 3]],
            [0, 0, 0, 1, 2, -1, -1, -1],
        ),
        # --- большие числа ---
        (
            1,
            5,
            [
                [999999, 1],
                [1000000, 0],
                [1000000, 1],
                [1000000, 0],
                [1000000, 0],
            ],
            [999999, 1000000, 1000000, -1, -1],
        ),
        # --- сложные сценарии ---
        (
            3,
            6,
            [[0, 7], [0, 0], [2, 0], [3, 3], [4, 0], [5, 0]],
            [0, 7, 7, -1, -1, -1],
        ),
        (
            2,
            6,
            [[0, 2], [0, 0], [2, 0], [3, 0], [4, 0], [5, 0]],
            [0, 2, 2, 3, 4, 5],
        ),
        (
            2,
            5,
            [[2, 9], [4, 8], [10, 9], [15, 2], [19, 1]],
            [2, 11, -1, 19, 21],
        ),
        # --- разреженные пакеты ---
        (1, 2, [[0, 1], [10, 10]], [0, 10]),
        (2, 3, [[0, 0], [10, 0], [10, 0]], [0, 10, 10]),
        (
            4,
            5,
            [[0, 7], [2, 7], [4, 7], [6, 7], [21, 7]],
            [0, 7, 14, 21, 28],
        ),
        (
            3,
            6,
            [[2, 2], [2, 3], [3, 1], [3, 4], [10, 2]],
            [2, 4, 7, -1, 10],
        ),
    ],
)
def test_package_processor(buf_size, count, packages, expected):
    assert m_1_2_3(buf_size, count, packages) == expected


# === Задача 4 ===


@pytest.mark.parametrize(
    "count, commands, expected",
    [
        # --- без max ---
        (
            3,
            ["push 1", "push 7", "pop"],
            "",
        ),
        # --- простой max ---
        (
            5,
            ["push 2", "push 1", "max", "pop", "max"],
            "2\n2",
        ),
        # --- несколько одинаковых максимумов ---
        (
            6,
            ["push 7", "push 1", "push 7", "max", "pop", "max"],
            "7\n7",
        ),
        # --- смена максимума ---
        (
            5,
            ["push 1", "push 2", "max", "pop", "max"],
            "2\n1",
        ),
        # --- несколько подряд max ---
        (
            10,
            [
                "push 2",
                "push 3",
                "push 9",
                "push 7",
                "push 2",
                "max",
                "max",
                "max",
                "pop",
                "max",
            ],
            "9\n9\n9\n9",
        ),
    ],
)
def test_special_stack(count, commands, expected):
    assert m_1_2_4(count, commands) == expected


# === Задача 5 ===


@pytest.mark.parametrize(
    "length, array, window, expected",
    [
        # --- окно размера 1 ---
        (
            3,
            [2, 1, 5],
            1,
            "2 1 5",
        ),
        # --- базовый пример ---
        (
            8,
            [2, 7, 3, 1, 5, 2, 6, 2],
            4,
            "7 7 5 6 6",
        ),
        # --- длинный массив, большое окно ---
        (
            15,
            [73, 65, 24, 14, 44, 20, 65, 97, 27, 6, 42, 1, 6, 41, 16],
            7,
            "73 97 97 97 97 97 97 97 42",
        ),
        (
            15,
            [28, 7, 64, 40, 68, 86, 80, 93, 4, 53, 32, 56, 68, 18, 59],
            12,
            "93 93 93 93",
        ),
        (
            15,
            [16, 79, 20, 19, 43, 72, 78, 33, 40, 52, 70, 79, 66, 43, 60],
            12,
            "79 79 79 79",
        ),
        # --- чередование спадов и пиков ---
        (
            15,
            [34, 51, 61, 90, 26, 84, 2, 25, 7, 8, 25, 78, 21, 47, 25],
            3,
            "61 90 90 90 84 84 25 25 25 78 78 78 47",
        ),
        (
            15,
            [27, 83, 29, 77, 6, 3, 48, 2, 16, 72, 46, 38, 55, 2, 58],
            5,
            "83 83 77 77 48 72 72 72 72 72 58",
        ),
    ],
)
def test_max_in_subarray(length, array, window, expected):
    assert m_1_2_5(length, array, window) == expected
